{"ast":null,"code":"import { bnToBn } from '../bn/toBn.js';\nimport { isBoolean } from '../is/boolean.js';\nimport { formatDecimal } from './formatDecimal.js';\nimport { getSeparator } from './getSeparator.js';\nimport { calcSi, findSi, SI, SI_MID } from './si.js';\nconst DEFAULT_DECIMALS = 0;\nconst DEFAULT_UNIT = SI[SI_MID].text;\nlet defaultDecimals = DEFAULT_DECIMALS;\nlet defaultUnit = DEFAULT_UNIT;\nfunction _formatBalance(input, {\n  decimals = defaultDecimals,\n  forceUnit,\n  locale = 'en',\n  withAll = false,\n  withSi = true,\n  withSiFull = false,\n  withUnit = true,\n  withZero = true\n} = {}) {\n  // we only work with string inputs here - convert anything\n  // into the string-only value\n  let text = bnToBn(input).toString();\n  if (text.length === 0 || text === '0') {\n    return '0';\n  }\n  // strip the negative sign so we can work with clean groupings, re-add this in the\n  // end when we return the result (from here on we work with positive numbers)\n  let sign = '';\n  if (text[0].startsWith('-')) {\n    sign = '-';\n    text = text.substring(1);\n  }\n  // We start at midpoint (8) minus 1 - this means that values display as\n  // 123.4567 instead of 0.1234 k (so we always have the most relevant).\n  const si = calcSi(text, decimals, forceUnit);\n  const mid = text.length - (decimals + si.power);\n  const pre = mid <= 0 ? '0' : text.substring(0, mid);\n  // get the post from the midpoint onward and then first add max decimals\n  // before trimming to the correct (calculated) amount of decimals again\n  let post = text.padStart(mid < 0 ? decimals : 1, '0').substring(mid < 0 ? 0 : mid).padEnd(withAll ? Math.max(decimals, 4) : 4, '0').substring(0, withAll ? Math.max(4, decimals + si.power) : 4);\n  // remove all trailing 0's (if required via flag)\n  if (!withZero) {\n    let end = post.length - 1;\n    // This looks inefficient, however it is better to do the checks and\n    // only make one final slice than it is to do it in multiples\n    do {\n      if (post[end] === '0') {\n        end--;\n      }\n    } while (post[end] === '0');\n    post = post.substring(0, end + 1);\n  }\n  // the display unit\n  const unit = isBoolean(withUnit) ? SI[SI_MID].text : withUnit;\n  // format the units for display based on the flags\n  const units = withSi || withSiFull ? si.value === '-' ? withUnit ? ` ${unit}` : '' : ` ${withSiFull ? `${si.text}${withUnit ? ' ' : ''}` : si.value}${withUnit ? unit : ''}` : '';\n  const {\n    decimal,\n    thousand\n  } = getSeparator(locale);\n  return `${sign}${formatDecimal(pre, thousand)}${post && `${decimal}${post}`}${units}`;\n}\nexport const formatBalance = _formatBalance;\nformatBalance.calcSi = (text, decimals = defaultDecimals) => calcSi(text, decimals);\nformatBalance.findSi = findSi;\nformatBalance.getDefaults = () => {\n  return {\n    decimals: defaultDecimals,\n    unit: defaultUnit\n  };\n};\nformatBalance.getOptions = (decimals = defaultDecimals) => {\n  return SI.filter(({\n    power\n  }) => power < 0 ? decimals + power >= 0 : true);\n};\nformatBalance.setDefaults = ({\n  decimals,\n  unit\n}) => {\n  defaultDecimals = (Array.isArray(decimals) ? decimals[0] : decimals) ?? defaultDecimals;\n  defaultUnit = (Array.isArray(unit) ? unit[0] : unit) ?? defaultUnit;\n  SI[SI_MID].text = defaultUnit;\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}