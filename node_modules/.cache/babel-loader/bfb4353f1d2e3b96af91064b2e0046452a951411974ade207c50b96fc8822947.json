{"ast":null,"code":"import { xglobal } from '@polkadot/x-global';\nimport { isFunction } from './is/function.js';\nconst DEDUPE = 'Either remove and explicitly install matching versions or dedupe using your package manager.\\nThe following conflicting packages were found:';\nexport const POLKADOTJS_DISABLE_ESM_CJS_WARNING_FLAG = 'POLKADOTJS_DISABLE_ESM_CJS_WARNING';\n/** @internal */\nfunction getEntry(name) {\n  const _global = xglobal;\n  if (!_global.__polkadotjs) {\n    _global.__polkadotjs = {};\n  }\n  if (!_global.__polkadotjs[name]) {\n    _global.__polkadotjs[name] = [];\n  }\n  return _global.__polkadotjs[name];\n}\n/** @internal */\nfunction formatDisplay(all, fmt) {\n  let max = 0;\n  for (let i = 0, count = all.length; i < count; i++) {\n    max = Math.max(max, all[i].version.length);\n  }\n  return all.map(d => `\\t${fmt(d.version.padEnd(max), d).join('\\t')}`).join('\\n');\n}\n/** @internal */\nfunction formatInfo(version, {\n  name\n}) {\n  return [version, name];\n}\n/** @internal */\nfunction formatVersion(version, {\n  path,\n  type\n}) {\n  let extracted;\n  if (path && path.length >= 5) {\n    const nmIndex = path.indexOf('node_modules');\n    extracted = nmIndex === -1 ? path : path.substring(nmIndex);\n  } else {\n    extracted = '<unknown>';\n  }\n  return [`${`${type || ''}`.padStart(3)} ${version}`, extracted];\n}\n/** @internal */\nfunction getPath(infoPath, pathOrFn) {\n  if (infoPath) {\n    return infoPath;\n  } else if (isFunction(pathOrFn)) {\n    try {\n      return pathOrFn() || '';\n    } catch {\n      return '';\n    }\n  }\n  return pathOrFn || '';\n}\n/** @internal */\nfunction warn(pre, all, fmt) {\n  console.warn(`${pre}\\n${DEDUPE}\\n${formatDisplay(all, fmt)}`);\n}\n/**\n * @name detectPackage\n * @summary Checks that a specific package is only imported once\n * @description A `@polkadot/*` version detection utility, checking for one occurrence of a package in addition to checking for dependency versions.\n */\nexport function detectPackage({\n  name,\n  path,\n  type,\n  version\n}, pathOrFn, deps = []) {\n  if (!name.startsWith('@polkadot')) {\n    throw new Error(`Invalid package descriptor ${name}`);\n  }\n  const entry = getEntry(name);\n  entry.push({\n    path: getPath(path, pathOrFn),\n    type,\n    version\n  });\n  // if we have more than one entry at DIFFERENT version types then warn. If there is\n  // more than one entry at the same version and ESM/CJS dual warnings are disabled,\n  // then do not display warnings\n  const entriesSameVersion = entry.every(e => e.version === version);\n  const esmCjsWarningDisabled = xglobal.process?.env?.[POLKADOTJS_DISABLE_ESM_CJS_WARNING_FLAG] === '1';\n  const multipleEntries = entry.length !== 1;\n  const disableWarnings = esmCjsWarningDisabled && entriesSameVersion;\n  if (multipleEntries && !disableWarnings) {\n    warn(`${name} has multiple versions, ensure that there is only one installed.`, entry, formatVersion);\n  } else {\n    const mismatches = deps.filter(d => d && d.version !== version);\n    if (mismatches.length) {\n      warn(`${name} requires direct dependencies exactly matching version ${version}.`, mismatches, formatInfo);\n    }\n  }\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}