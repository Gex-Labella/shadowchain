{"ast":null,"code":"import { BN, bnToBn, bnToU8a, isBn, isNumber, isString, isU8a, isUndefined, objectProperties, stringify, stringPascalCase, u8aToBn, u8aToHex, u8aToU8a } from '@polkadot/util';\nimport { compareArray } from '../utils/index.js';\nfunction encodeSet(setValues, values) {\n  const encoded = new BN(0);\n  for (let i = 0, count = values.length; i < count; i++) {\n    encoded.ior(bnToBn(setValues[values[i]] || 0));\n  }\n  return encoded;\n}\n/** @internal */\nfunction decodeSetArray(setValues, values) {\n  const count = values.length;\n  const result = new Array(count);\n  for (let i = 0; i < count; i++) {\n    const key = values[i];\n    if (isUndefined(setValues[key])) {\n      throw new Error(`Set: Invalid key '${key}' passed to Set, allowed ${Object.keys(setValues).join(', ')}`);\n    }\n    result[i] = key;\n  }\n  return result;\n}\n/** @internal */\nfunction decodeSetNumber(setValues, _value) {\n  const bn = bnToBn(_value);\n  const keys = Object.keys(setValues);\n  const result = [];\n  for (let i = 0, count = keys.length; i < count; i++) {\n    const key = keys[i];\n    if (bn.and(bnToBn(setValues[key])).eq(bnToBn(setValues[key]))) {\n      result.push(key);\n    }\n  }\n  const computed = encodeSet(setValues, result);\n  if (!bn.eq(computed)) {\n    throw new Error(`Set: Mismatch decoding '${bn.toString()}', computed as '${computed.toString()}' with ${result.join(', ')}`);\n  }\n  return result;\n}\n/** @internal */\nfunction decodeSet(setValues, value = 0, bitLength) {\n  if (bitLength % 8 !== 0) {\n    throw new Error(`Expected valid bitLength, power of 8, found ${bitLength}`);\n  }\n  const byteLength = bitLength / 8;\n  if (isU8a(value)) {\n    return value.length === 0 ? [] : decodeSetNumber(setValues, u8aToBn(value.subarray(0, byteLength), {\n      isLe: true\n    }));\n  } else if (isString(value)) {\n    return decodeSet(setValues, u8aToU8a(value), byteLength);\n  } else if (value instanceof Set || Array.isArray(value)) {\n    const input = Array.isArray(value) ? value : [...value.values()];\n    return decodeSetArray(setValues, input);\n  }\n  return decodeSetNumber(setValues, value);\n}\n/**\n * @name Set\n * @description\n * An Set is an array of string values, represented an an encoded type by\n * a bitwise representation of the values.\n */\nexport class CodecSet extends Set {\n  registry;\n  createdAtHash;\n  initialU8aLength;\n  isStorageFallback;\n  __internal__allowed;\n  __internal__byteLength;\n  constructor(registry, setValues, value, bitLength = 8) {\n    super(decodeSet(setValues, value, bitLength));\n    this.registry = registry;\n    this.__internal__allowed = setValues;\n    this.__internal__byteLength = bitLength / 8;\n  }\n  static with(values, bitLength) {\n    return class extends CodecSet {\n      static {\n        const keys = Object.keys(values);\n        const count = keys.length;\n        const isKeys = new Array(count);\n        for (let i = 0; i < count; i++) {\n          isKeys[i] = `is${stringPascalCase(keys[i])}`;\n        }\n        objectProperties(this.prototype, isKeys, (_, i, self) => self.strings.includes(keys[i]));\n      }\n      constructor(registry, value) {\n        super(registry, values, value, bitLength);\n      }\n    };\n  }\n  /**\n   * @description The length of the value when encoded as a Uint8Array\n   */\n  get encodedLength() {\n    return this.__internal__byteLength;\n  }\n  /**\n   * @description returns a hash of the contents\n   */\n  get hash() {\n    return this.registry.hash(this.toU8a());\n  }\n  /**\n   * @description true is the Set contains no values\n   */\n  get isEmpty() {\n    return this.size === 0;\n  }\n  /**\n   * @description The actual set values as a string[]\n   */\n  get strings() {\n    return [...super.values()];\n  }\n  /**\n   * @description The encoded value for the set members\n   */\n  get valueEncoded() {\n    return encodeSet(this.__internal__allowed, this.strings);\n  }\n  /**\n   * @description adds a value to the Set (extended to allow for validity checking)\n   */\n  add = key => {\n    // ^^^ add = () property done to assign this instance's this, otherwise Set.add creates \"some\" chaos\n    // we have the isUndefined(this._setValues) in here as well, add is used internally\n    // in the Set constructor (so it is undefined at this point, and should allow)\n    if (this.__internal__allowed && isUndefined(this.__internal__allowed[key])) {\n      throw new Error(`Set: Invalid key '${key}' on add`);\n    }\n    super.add(key);\n    return this;\n  };\n  /**\n   * @description Compares the value of the input to see if there is a match\n   */\n  eq(other) {\n    if (Array.isArray(other)) {\n      // we don't actually care about the order, sort the values\n      return compareArray(this.strings.sort(), other.sort());\n    } else if (other instanceof Set) {\n      return this.eq([...other.values()]);\n    } else if (isNumber(other) || isBn(other)) {\n      return this.valueEncoded.eq(bnToBn(other));\n    }\n    return false;\n  }\n  /**\n   * @description Returns a breakdown of the hex encoding for this Codec\n   */\n  inspect() {\n    return {\n      outer: [this.toU8a()]\n    };\n  }\n  /**\n   * @description Returns a hex string representation of the value\n   */\n  toHex() {\n    return u8aToHex(this.toU8a());\n  }\n  /**\n   * @description Converts the Object to to a human-friendly JSON, with additional fields, expansion and formatting of information\n   */\n  toHuman() {\n    return this.toJSON();\n  }\n  /**\n   * @description Converts the Object to JSON, typically used for RPC transfers\n   */\n  toJSON() {\n    return this.strings;\n  }\n  /**\n   * @description The encoded value for the set members\n   */\n  toNumber() {\n    return this.valueEncoded.toNumber();\n  }\n  /**\n   * @description Converts the value in a best-fit primitive form\n   */\n  toPrimitive() {\n    return this.toJSON();\n  }\n  /**\n   * @description Returns the base runtime type name for this instance\n   */\n  toRawType() {\n    return stringify({\n      _set: this.__internal__allowed\n    });\n  }\n  /**\n   * @description Returns the string representation of the value\n   */\n  toString() {\n    return `[${this.strings.join(', ')}]`;\n  }\n  /**\n   * @description Encodes the value as a Uint8Array as per the SCALE specifications\n   */\n  toU8a(_isBare) {\n    return bnToU8a(this.valueEncoded, {\n      bitLength: this.__internal__byteLength * 8,\n      isLe: true\n    });\n  }\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}