{"ast":null,"code":"import { combineLatest, map, of, switchMap } from 'rxjs';\nimport { memo } from '../util/index.js';\nexport function nextElected(instanceId, api) {\n  return memo(instanceId, () =>\n  // Compatibility for future generation changes in staking.\n  api.query.staking.erasStakersPaged ? api.derive.session.indexes().pipe(\n  // only populate for next era in the last session, so track both here - entries are not\n  // subscriptions, so we need a trigger - currentIndex acts as that trigger to refresh\n  switchMap(({\n    currentEra\n  }) => api.query.staking.erasStakersPaged.keys(currentEra)),\n  // Dedupe any duplicates\n  map(keys => [...new Set(keys.map(({\n    args: [, accountId]\n  }) => accountId.toString()))].map(a => api.registry.createType('AccountId', a)))) : api.query.staking.erasStakers ? api.derive.session.indexes().pipe(\n  // only populate for next era in the last session, so track both here - entries are not\n  // subscriptions, so we need a trigger - currentIndex acts as that trigger to refresh\n  switchMap(({\n    currentEra\n  }) => api.query.staking.erasStakers.keys(currentEra)),\n  // Dedupe any duplicates\n  map(keys => [...new Set(keys.map(({\n    args: [, accountId]\n  }) => accountId.toString()))].map(a => api.registry.createType('AccountId', a)))) : api.query.staking['currentElected']());\n}\n/**\n * @description Retrieve latest list of validators\n */\nexport function validators(instanceId, api) {\n  return memo(instanceId, () =>\n  // Sadly the node-template is (for some obscure reason) not comprehensive, so while the derive works\n  // in all actual real-world deployed chains, it does create some confusion for limited template chains\n  combineLatest([api.query.session ? api.query.session.validators() : of([]), api.query.staking ? api.derive.staking.nextElected() : of([])]).pipe(map(([validators, nextElected]) => ({\n    nextElected: nextElected.length ? nextElected : validators,\n    validators\n  }))));\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}