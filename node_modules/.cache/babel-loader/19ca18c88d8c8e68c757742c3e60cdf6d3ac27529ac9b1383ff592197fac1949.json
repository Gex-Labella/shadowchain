{"ast":null,"code":"import { combineLatest, map, of } from 'rxjs';\nimport { memo } from '../util/index.js';\nimport { getEraCache, setEraCache } from './cache.js';\nimport { combineEras, erasHistoricApply, singleEra } from './util.js';\nconst CACHE_KEY = 'eraSlashes';\nfunction mapSlashes(era, noms, vals) {\n  const nominators = {};\n  const validators = {};\n  noms.forEach(([key, optBalance]) => {\n    nominators[key.args[1].toString()] = optBalance.unwrap();\n  });\n  vals.forEach(([key, optRes]) => {\n    validators[key.args[1].toString()] = optRes.unwrapOrDefault()[1];\n  });\n  return {\n    era,\n    nominators,\n    validators\n  };\n}\nexport function _eraSlashes(instanceId, api) {\n  return memo(instanceId, (era, withActive) => {\n    const [cacheKey, cached] = getEraCache(CACHE_KEY, era, withActive);\n    return cached ? of(cached) : combineLatest([api.query.staking.nominatorSlashInEra.entries(era), api.query.staking.validatorSlashInEra.entries(era)]).pipe(map(([n, v]) => setEraCache(cacheKey, withActive, mapSlashes(era, n, v))));\n  });\n}\nexport const eraSlashes = /*#__PURE__*/singleEra('_eraSlashes');\nexport const _erasSlashes = /*#__PURE__*/combineEras('_eraSlashes');\nexport const erasSlashes = /*#__PURE__*/erasHistoricApply('_erasSlashes');","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}