{"ast":null,"code":"import { combineLatest, map, of } from 'rxjs';\nimport { memo } from '../util/index.js';\nfunction isVoter(value) {\n  return !Array.isArray(value);\n}\nfunction retrieveStakeOf(elections) {\n  return elections['stakeOf'].entries().pipe(map(entries => entries.map(([{\n    args: [accountId]\n  }, stake]) => [accountId, stake])));\n}\nfunction retrieveVoteOf(elections) {\n  return elections['votesOf'].entries().pipe(map(entries => entries.map(([{\n    args: [accountId]\n  }, votes]) => [accountId, votes])));\n}\nfunction retrievePrev(api, elections) {\n  return combineLatest([retrieveStakeOf(elections), retrieveVoteOf(elections)]).pipe(map(([stakes, votes]) => {\n    const result = [];\n    votes.forEach(([voter, votes]) => {\n      result.push([voter, {\n        stake: api.registry.createType('Balance'),\n        votes\n      }]);\n    });\n    stakes.forEach(([staker, stake]) => {\n      const entry = result.find(([voter]) => voter.eq(staker));\n      if (entry) {\n        entry[1].stake = stake;\n      } else {\n        result.push([staker, {\n          stake,\n          votes: []\n        }]);\n      }\n    });\n    return result;\n  }));\n}\nfunction retrieveCurrent(elections) {\n  return elections.voting.entries().pipe(map(entries => entries.map(([{\n    args: [accountId]\n  }, value]) => [accountId, isVoter(value) ? {\n    stake: value.stake,\n    votes: value.votes\n  } : {\n    stake: value[0],\n    votes: value[1]\n  }])));\n}\nexport function votes(instanceId, api) {\n  const elections = api.query.elections || api.query['phragmenElection'] || api.query['electionsPhragmen'];\n  return memo(instanceId, () => elections ? elections['stakeOf'] ? retrievePrev(api, elections) : retrieveCurrent(elections) : of([]));\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}