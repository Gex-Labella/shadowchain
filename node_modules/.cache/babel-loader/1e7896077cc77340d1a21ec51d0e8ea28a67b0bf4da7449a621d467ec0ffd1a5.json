{"ast":null,"code":"import { isFunction, noop } from '@polkadot/util';\nexport class Combinator {\n  __internal__allHasFired = false;\n  __internal__callback;\n  __internal__fired = [];\n  __internal__fns = [];\n  __internal__isActive = true;\n  __internal__results = [];\n  __internal__subscriptions = [];\n  constructor(fns, callback) {\n    this.__internal__callback = callback;\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises, @typescript-eslint/require-await\n    this.__internal__subscriptions = fns.map(async (input, index) => {\n      const [fn, ...args] = Array.isArray(input) ? input : [input];\n      this.__internal__fired.push(false);\n      this.__internal__fns.push(fn);\n      // Not quite 100% how to have a variable number at the front here\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-return,@typescript-eslint/ban-types\n      return fn(...args, this._createCallback(index));\n    });\n  }\n  _allHasFired() {\n    this.__internal__allHasFired ||= this.__internal__fired.filter(hasFired => !hasFired).length === 0;\n    return this.__internal__allHasFired;\n  }\n  _createCallback(index) {\n    return value => {\n      this.__internal__fired[index] = true;\n      this.__internal__results[index] = value;\n      this._triggerUpdate();\n    };\n  }\n  _triggerUpdate() {\n    if (!this.__internal__isActive || !isFunction(this.__internal__callback) || !this._allHasFired()) {\n      return;\n    }\n    try {\n      Promise.resolve(this.__internal__callback(this.__internal__results)).catch(noop);\n    } catch {\n      // swallow, we don't want the handler to trip us up\n    }\n  }\n  unsubscribe() {\n    if (!this.__internal__isActive) {\n      return;\n    }\n    this.__internal__isActive = false;\n    Promise.all(this.__internal__subscriptions.map(async subscription => {\n      try {\n        const unsubscribe = await subscription;\n        if (isFunction(unsubscribe)) {\n          unsubscribe();\n        }\n      } catch {\n        // ignore\n      }\n    })).catch(() => {\n      // ignore, already ignored above, should never throw\n    });\n  }\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}